<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <title>FitMatch Profile Page</title>

  <!-- Bootstrap for Mobile-first, and JQuery -->
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
  <link rel="stylesheet" href="./styles/profile.css">
  <link rel="stylesheet" href="./styles/my_app_palette3.css">

  <link rel="shortcut icon" href="/images/droplet-icon-2.png" type="image/x-icon" />

  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Work+Sans:wght@600&display=swap" rel="stylesheet">

  <!-- Copied from firebase documentation -->
  <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-app.js"></script>

  <!-- Add Firebase products that you want to use -->
  <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/7.24.0/firebase-firestore.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-storage.js"></script>
</head>

<body>
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <a class="navbar-brand" href="profile.html"><img src="./images/usericon-2.png" alt="icon" id=icon></a>

    <!--Dropdown button center to change to groups-->
    <div class="navbar-brand">
      <div><span id="UserName">Profile</span></div>
    </div>

    <!--Dropdown button Top Right-->
    <div class="dropdown">
      <button class="navbar-toggler " type="button" data-toggle="collapse" data-target="#navbarTogglerDemo02">
        <span class="navbar-toggler-icon"></span>
        <div class="dropdown-content">
          <a href="home.html">Matches</a>
          <a href="messages.html">Messages</a>
        </div>
      </button>
    </div>

    <div class="collapse navbar-collapse" id="navbarTogglerDemo02">
      <ul class="navbar-nav ml-auto">
        <li class="nav-item">
          <a class="nav-link" href="home.html"><span id="matches">Matches</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="messages.html"><span id="messages">Messages</span></a>
        </li>
      </ul>
    </div>
  </nav>

  <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
  <main class="main_full">
    <div class="container">
      <div class="panel">
        <div class="button_outer">
          <div class="btn_upload">
            <input type="file" id="upload_file" name="">
            Upload Profile Picture
          </div>
          <div class="processing_bar"></div>
          <div class="success_box"></div>
        </div>
      </div>
      <div class="error_msg"></div>
      <div class="uploaded_file_view" id="uploaded_view">
        <span class="file_remove">X</span>
      </div>
    </div>
  </main>

  <!-- Uploads Profile Picture-->
  <script>
    var btnUpload = $("#upload_file"),
      btnOuter = $(".button_outer");
    btnUpload.on("change", function (e) {
      var ext = btnUpload.val().split('.').pop().toLowerCase();
      if ($.inArray(ext, ['gif', 'png', 'jpg', 'jpeg']) == -1) {
        $(".error_msg").text("Not an Image...");
      } else {
        $(".error_msg").text("");
        btnOuter.addClass("file_uploading");
        setTimeout(function () {
          btnOuter.addClass("file_uploaded");
        }, 3000);
        
        var uploadedFile = (e.target.files[0]);
        var uploadedFileURL = URL.createObjectURL(e.target.files[0]);
        var user = firebase.auth().currentUser;
        var storageRef = firebase.storage().ref(user.displayName + '/ProfilePicture/' + uploadedFile.name);
        console.log(storageRef);
        storageRef.put(uploadedFile);
        storageRef.getDownloadURL()
        .then(function(url){
          console.log(url);
          db.collection("users").doc(user.uid).update({
            photo: url
          })
        })

        setTimeout(function () {
          $("#uploaded_view").prepend('<img src="' + uploadedFileURL + '" />').addClass("show");
        }, 3500);
      }
    });
    $(".file_remove").on("click", function (e) {
      $("#uploaded_view").removeClass("show");
      $("#uploaded_view").find("img").remove();
      btnOuter.removeClass("file_uploading");
      btnOuter.removeClass("file_uploaded");
      //.uploaded_file_view img
    });
  </script>

  <!---->
  <form>
    <h1>Personal Information</h1>
    <label for="Gender">Gender</label><br>
    <select id="Gender" name="Gender">
      <option value="Male">Male</option>
      <option value="Female">Female</option>
      <option value="Other">Other</option>
    </select>
    <br>
    <label for="Birth date">Birth Date</label><br>
    <input type="date" id="Birthday" name="birthday"><br>
    <label for="Location">Location</label><br>
    <input type="text" id="City" name="City" placeholder="City"><br>
    <input type="text" id="Province" name="Province" placeholder="Province"><br>

    <h1>Fitness Interests</h1>
    <p>Activities youâ€™re interested in will be added as tags to your profile.</p>

    <label for="Activity-1">Activity 1</label><br>
    <select id="Activity-1" name="Activity-1">
      <option value="Soccer">Soccer</option>
      <option value="Badminton">Badminton</option>
      <option value="Volleyball">Volleyball</option>
      <option value="Dancing">Dancing</option>
      <option value="Basketball">Basketball</option>
      <option value="Running">Running</option>
      <option value="Skiing">Skiing</option>
      <option value="Other">Other</option>
    </select><br>
    
    <select id="SkillLevel-1" name="SkillLevel-1">
      <option value="Beginner">Beginner</option>
      <option value="Intermediate">Intermediate</option>
      <option value="Expert">Expert</option>
    </select><br>
  </form>
  <a class="btn btn-secondary" id="save" href=# role="button">Save</a>
  <a class="btn btn-secondary" id="home" href="home.html" role="button">Back to Home</a>

  <script src="./scripts/firebase_api_fitmatch.js"> </script>
  <script src="./scripts/readUserName.js"> </script>
  <script src="./scripts/saveProfile.js"> </script>
  <!--<script src="./scripts/readProfileData.js"></script>-->
</body>